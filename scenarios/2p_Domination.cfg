#textdomain wesnoth-Survivals_WoL

#define SCORE_BOARD_UPDATE
    [header_message]
        caption= _ "Scenario Scoreboard"
        message= _ "North <span fgcolor='red'>$team_north_score</span> | <span fgcolor='blue'>$team_south_score</span> South"
    [/header_message]
#enddef

#define CHAT_UPDATE_MSG MSG_STR
    [chat]
        speaker="Update"
        message={MSG_STR}
    [/chat]
#enddef

#define CAP_DECAP_EVENTS X Y LABEL_TXT
    [event]
        name=enter_hex
        first_time_only=no

        [filter]
            side=1
            x,y={X},{Y}
        [/filter]

        [floating_text]
            x,y={X},{Y}
            text= _ "Captured!"
        [/floating_text]

        [label]
            x,y={X},{Y}
            text="<span fgcolor='red'>"+{LABEL_TXT}+"</span>"
        [/label]
    [/event]
    [event]
        name=enter_hex
        first_time_only=no

        [filter]
            side=2
            x,y={X},{Y}
        [/filter]

        [floating_text]
            x,y={X},{Y}
            text= _ "Captured!"
        [/floating_text]

        [label]
            x,y={X},{Y}
            text="<span fgcolor='blue'>"+{LABEL_TXT}+"</span>"
        [/label]
    [/event]
    [event]
        name=exit_hex
        first_time_only=no

        [filter]
            x,y={X},{Y}
        [/filter]

        [label]
            x,y={X},{Y}
            text={LABEL_TXT}
        [/label]
    [/event]
    # decap if any unit died here
    [event]
        name=die
        first_time_only=no

        [filter]
            x,y={X},{Y}
        [/filter]

        [label]
            x,y={X},{Y}
            text={LABEL_TXT}
        [/label]
    [/event]

    # more point scoring event
    [event]
        name="die"
        first_time_only=no

        [filter]
            side=1
            x={X}
            y={Y}
            radius=1
        [/filter]

        [if]
            [have_unit]
                side=2
                x={X}
                y={Y}
            [/have_unit]

            [then]
                [floating_text]
                    x,y={X},{Y}
                    text=text="<span color='LightSkyBlue'>" + _ "+5" + "</span>"
                [/floating_text]

                {VARIABLE_OP team_south_score add 5}
            [/then]
        [/if]
    [/event]

    [event]
        name="die"
        first_time_only=no

        [filter]
            side=2
            x={X}
            y={Y}
            radius=2
        [/filter]

        [if]
            [have_unit]
                side=1
                x={X}
                y={Y}
            [/have_unit]

            [then]
                [floating_text]
                    x,y={X},{Y}
                    text=text="<span color='PaleVioletRed'>" + _ "+5" + "</span>"
                [/floating_text]

                {VARIABLE_OP team_north_score add 5}
            [/then]
        [/if]
    [/event]
#enddef

[multiplayer]
    id=multiplayer_2p_Domination_knyght
    name= _ "2p â€” Domination"
    map_file=Control_Domination.map
    turns=unlimited

    description= _ "This 1v1 Scenario is focused on the game mode Domination. There are five points on the map which generate points if captured. The goal is to score higher than your opponents. Units have to be stationed on points to generate points. The AI can technically play this game mode but the performance is not as good as a human player."

    victory_when_enemies_defeated=yes
    force_lock_settings=yes

    experience_modifier=60
    require_scenario=yes

    mp_village_gold=1
    mp_village_support=2

    {DEFAULT_SCHEDULE}
    random_start_time=yes

    {DEFAULT_MUSIC_PLAYLIST}

    # define sides
    # north
    [side]
        side=1
        user_team_name=_ "North"
        team_name="north"
        canrecruit=yes
        controller=human
        controller_lock=no
        gold=125
        gold_lock=yes
        fog=yes
        defeat_condition=never
        shroud=no
        income=2
        income_lock=yes
        team_lock=yes
        faction_lock=no
        leader_lock=no
        [ai]
            [goal]
                name=target
                [criteria]
                    side=2
                [/criteria]
                value=50
            [/goal]
            [goal]
                name=target_location
                [criteria]
                    x= 4,30
                    y=10,10
                [/criteria]
                value=5000
            [/goal]
            [goal]
                name=target_location
                [criteria]
                    x=17
                    y=17
                [/criteria]
                value=3750
            [/goal]
            [goal]
                name=target_location
                [criteria]
                    x= 4,30
                    y=23,23
                [/criteria]
                value=1750
            [/goal]

            [goal]
                name=protect_location
                [criteria]
                    x=17
                    y=17
                [/criteria]
                value=2000
                protect_radius=3
            [/goal]
            [goal]
                name=protect_location
                [criteria]
                    x= 4,30
                    y=10,10
                [/criteria]
                value=2000
                protect_radius=3
            [/goal]
        [/ai]
    [/side]

    # south
    [side]
        side=2
        user_team_name=_ "South"
        team_name="south"
        canrecruit=yes
        controller=human
        controller_lock=no
        gold=125
        gold_lock=yes
        fog=yes
        defeat_condition=never
        shroud=no
        income=2
        income_lock=yes
        team_lock=yes
        faction_lock=no
        leader_lock=no
        [ai]
            [goal]
                name=target
                [criteria]
                    side=1
                [/criteria]
                value=50
            [/goal]
            [goal]
                name=target_location
                [criteria]
                    x= 4,30
                    y=23,23
                [/criteria]
                value=5000
            [/goal]
            # prioritise mid second
            [goal]
                name=target_location
                [criteria]
                    x=17
                    y=17
                [/criteria]
                value=3750
            [/goal]
            # do not focus too much on farthest points
            [goal]
                name=target_location
                [criteria]
                    x= 4,30
                    y=10,10
                [/criteria]
                value=1750
            [/goal]

            [goal]
                name=protect_location
                [criteria]
                    x=17
                    y=17
                [/criteria]
                value=2000
                protect_radius=3
            [/goal]
            [goal]
                name=protect_location
                [criteria]
                    x= 4,30
                    y=23,23
                [/criteria]
                value=2000
                protect_radius=3
            [/goal]
        [/ai]
    [/side]

    # load the lua
    [lua]
        code = <<
        wesnoth.dofile("~add-ons/Survivals_WoL/lua/domination_main.lua")
    >>
    [/lua]

    # options
    [options]
        [slider]
            id=knyght_dominaton_point_threshold
            default=250
            min=200
            max=500
            step=25
            name= _ "Maximum Score Limit"
            description= _ "Select the score threshold for the scenario"
        [/slider]
    [/options]

    # prestart
    [event]
        name="prestart"

        {COLOR_ADJUST -15 -15 -15}

        [objectives]
            side=1,2
            [objective]
                description= _ "Score reaches $knyght_dominaton_point_threshold"
                condition=win
            [/objective]

            [objective]
                description= _ "Opposing Team reaches $knyght_dominaton_point_threshold score"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of your Leader"
                condition=lose
            [/objective]

            [note]
                description= _ "Keeping control points occupied generates points"
            [/note]
            [note]
                description= _ "Central point generates +15 points if occupied"
            [/note]
            [note]
                description= _ "Other points generate +10 points if occupied"
            [/note]
            [note]
                description= _ "Enemy units killed near captured point grants +5 points"
            [/note]
        [/objectives]

        # mark points
        [label]
            x,y=17,17
            text= _ "Central"
        [/label]

        [label]
            x,y=4,10
            text= _ "North-West"
        [/label]
        [label]
            x,y=30,10
            text= _ "North-East"
        [/label]

        [label]
            x,y=4,23
            text= _ "South-West"
        [/label]
        [label]
            x,y=30,23
            text= _ "South-East"
        [/label]

        # initialise scores
        {VARIABLE team_north_score 0}
        {VARIABLE team_south_score 0}

        # micro AI to make for the points
        [micro_ai]
            side=1
            ai_type=goto
            action=add
            ca_id=side1_rush_points
            [filter]
                side=1
                canrecruit=no
            [/filter]
            [filter_location]
                x= 4,30,17,30, 4
                y=10,10,17,23,23
            [/filter_location]

            release_unit_at_goal=yes
            unique_goals=yes
        [/micro_ai]
        [micro_ai]
            side=2
            ai_type=goto
            action=add
            ca_id=side2_rush_points

            [filter]
                side=2
                canrecruit=no
            [/filter]
            [filter_location]
                x=30, 4,17,30, 4
                y=23,23,17,10,10
            [/filter_location]
            ca_score=210001

            release_unit_at_goal=yes
            unique_goals=yes
        [/micro_ai]
    [/event]

    # event to compensate AI for this scenario
    [event]
        name="side_turn_1"
        first_time_only=no
        id=ai_handicap_reverse

        [lua]
            code = <<
            local result = wesnoth.synchronize_choice(
                function()
                    return { value = "no" }
                end,
                function()
                    -- Called only on the client handling the current side, if it is an AI.
                    return { value = "yes" }
                end)
            wesnoth.set_variable("knyght_domination_check_if_ai"..wesnoth.current.side,result.value)
            >>
        [/lua]

        [if]
            {VARIABLE_CONDITIONAL knyght_domination_check_if_ai$side_number equals yes}
            [then]
                [chat]
                    speaker="Update"
                    message=_"Side $side_number is an AI-controlled side and has been slightly compensated due to not being properly adaptable to this mode."
                [/chat]

                [modify_side]
                    side=$side_number
                    income=6
                [/modify_side]

                [if]
                    {VARIABLE_CONDITIONAL side_number numerical_equals 1}
                    [then]
                        [capture_village]
                            side=$side_number
                            x=1-33
                            y=1-16
                        [/capture_village]
                    [/then]
                [/if]

                [if]
                    {VARIABLE_CONDITIONAL side_number numerical_equals 2}
                    [then]
                        [capture_village]
                            side=$side_number
                            x=1-33
                            y=17-33
                        [/capture_village]
                    [/then]
                [/if]
            [/then]
        [/if]
    [/event]

    # start event
    [event]
        name="start"
        {SCORE_BOARD_UPDATE}
    [/event]

    # calculate points
    [event]
        name="new turn"
        first_time_only=no

        # team North
        [if]
            [have_unit]
                side=1
                x,y=17,17
            [/have_unit]

            [then]
                {CHAT_UPDATE_MSG ( _ "Team North earns +15 points for holding Central.")}
                {SCROLL_TO 17 17}
                [floating_text]
                    x,y=17,17
                    text="<span color='PaleVioletRed'>" + _ "+15" + "</span>"
                [/floating_text]
                {VARIABLE_OP team_north_score add 15}
            [/then]
        [/if]

        [if]
            [have_unit]
                side=1
                x,y=4,10
            [/have_unit]

            [then]
                {CHAT_UPDATE_MSG ( _ "Team North earns +10 points for holding North-West.")}
                {SCROLL_TO 4 10}
                [floating_text]
                    x,y=4,10
                    text="<span color='PaleVioletRed'>" + _ "+15" + "</span>"
                [/floating_text]
                {VARIABLE_OP team_north_score add 10}
            [/then]
        [/if]
        [if]
            [have_unit]
                side=1
                x,y=30,10
            [/have_unit]

            [then]
                {CHAT_UPDATE_MSG ( _ "Team North earns +10 points for holding North-East.")}
                {SCROLL_TO 30 10}
                [floating_text]
                    x,y=30,10
                    text="<span color='PaleVioletRed'>" + _ "+15" + "</span>"
                [/floating_text]
                {VARIABLE_OP team_north_score add 10}
            [/then]
        [/if]
        [if]
            [have_unit]
                side=1
                x,y=4,23
            [/have_unit]

            [then]
                {CHAT_UPDATE_MSG ( _ "Team North earns +10 points for holding South-West.")}
                {SCROLL_TO 4 23}
                [floating_text]
                    x,y=4,23
                    text="<span color='PaleVioletRed'>" + _ "+15" + "</span>"
                [/floating_text]
                {VARIABLE_OP team_north_score add 10}
            [/then]
        [/if]
        [if]
            [have_unit]
                side=1
                x,y=30,23
            [/have_unit]

            [then]
                {CHAT_UPDATE_MSG ( _ "Team North earns +10 points for holding South-East.")}
                {SCROLL_TO 30 23}
                [floating_text]
                    x,y=30,23
                    text="<span color='PaleVioletRed'>" + _ "+15" + "</span>"
                [/floating_text]
                {VARIABLE_OP team_north_score add 10}
            [/then]
        [/if]

        # team South
        [if]
            [have_unit]
                side=2
                x,y=17,17
            [/have_unit]

            [then]
                {CHAT_UPDATE_MSG ( _ "Team South earns +15 points for holding Central.")}
                {SCROLL_TO 17 17}
                [floating_text]
                    x,y=17,17
                    text="<span color='LightSkyBlue'>" + _ "+15" + "</span>"
                [/floating_text]
                {VARIABLE_OP team_south_score add 15}
            [/then]
        [/if]

        [if]
            [have_unit]
                side=2
                x,y=4,10
            [/have_unit]

            [then]
                {CHAT_UPDATE_MSG ( _ "Team South earns +10 points for holding North-West.")}
                {SCROLL_TO 4 10}
                [floating_text]
                    x,y=4,10
                    text="<span color='LightSkyBlue'>" + _ "+15" + "</span>"
                [/floating_text]
                {VARIABLE_OP team_south_score add 10}
            [/then]
        [/if]
        [if]
            [have_unit]
                side=2
                x,y=30,10
            [/have_unit]

            [then]
                {CHAT_UPDATE_MSG ( _ "Team South earns +10 points for holding North-East.")}
                {SCROLL_TO 30 10}
                [floating_text]
                    x,y=30,10
                    text="<span color='LightSkyBlue'>" + _ "+15" + "</span>"
                [/floating_text]
                {VARIABLE_OP team_south_score add 10}
            [/then]
        [/if]
        [if]
            [have_unit]
                side=2
                x,y=4,23
            [/have_unit]

            [then]
                {CHAT_UPDATE_MSG ( _ "Team South earns +10 points for holding South-West.")}
                {SCROLL_TO 4 23}
                [floating_text]
                    x,y=4,23
                    text="<span color='LightSkyBlue'>" + _ "+15" + "</span>"
                [/floating_text]
                {VARIABLE_OP team_south_score add 10}
            [/then]
        [/if]
        [if]
            [have_unit]
                side=2
                x,y=30,23
            [/have_unit]

            [then]
                {CHAT_UPDATE_MSG ( _ "Team South earns +10 points for holding South-East.")}
                {SCROLL_TO 30 23}
                [floating_text]
                    x,y=30,23
                    text="<span color='LightSkyBlue'>" + _ "+15" + "</span>"
                [/floating_text]
                {VARIABLE_OP team_south_score add 10}
            [/then]
        [/if]

        {SCORE_BOARD_UPDATE}
    [/event]

    # victory controller
    [event]
        name="new turn"
        first_time_only=no

        # only execute after score reaches threshold
        [filter_condition]
            {VARIABLE_CONDITIONAL team_north_score greater_than_equal_to $knyght_dominaton_point_threshold}
            [or]
                {VARIABLE_CONDITIONAL team_south_score greater_than_equal_to $knyght_dominaton_point_threshold}
            [/or]
        [/filter_condition]

        [if]
            {VARIABLE_CONDITIONAL team_north_score greater_than $team_south_score}
            [then]
                [header_message]
                    caption= _ "Result: North Wins"
                    message= _ "North <span fgcolor='red'>$team_north_score</span> | <span fgcolor='blue'>$team_south_score</span> South"
                [/header_message]
                [endlevel]
                    [result]
                        side=1
                        result=victory
                    [/result]
                    [result]
                        side=2
                        result=defeat
                    [/result]
                [/endlevel]
            [/then]
            [else]
                [header_message]
                    caption= _ "Result: South Wins"
                    message= _ "North <span fgcolor='red'>$team_north_score</span> | <span fgcolor='blue'>$team_south_score</span> South"
                [/header_message]
                [endlevel]
                    [result]
                        side=1
                        result=defeat
                    [/result]
                    [result]
                        side=2
                        result=victory
                    [/result]
                [/endlevel]
            [/else]
        [/if]

        # fall back if equal scores
        [if]
            {VARIABLE_CONDITIONAL team_north_score numerical_equals $team_south_score}
            [then]
                [header_message]
                    caption= _ "Result: Match Tied"
                    message= _ "North <span fgcolor='red'>$team_north_score</span> | <span fgcolor='blue'>$team_south_score</span> South"
                [/header_message]
                [endlevel]
                    [result]
                        side=1
                        result=victory
                    [/result]
                    [result]
                        side=2
                        result=victory
                    [/result]
                [/endlevel]
            [/then]
        [/if]
    [/event]

    # enter hex events
    {CAP_DECAP_EVENTS 17 17 ( _ "Central")}
    {CAP_DECAP_EVENTS 4 23 ( _ "South-West")}
    {CAP_DECAP_EVENTS 4 10 ( _ "North-West")}

    {CAP_DECAP_EVENTS 30 10 ( _ "North-East")}
    {CAP_DECAP_EVENTS 30 23 ( _ "South-East")}

    # side 1 MAI events
    # only applies if side 1 is computer controlled
    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=1
            x,y=4,10
        [/filter]

        [micro_ai]
            side=1
            action=add
            ai_type=stationed_guardian
            distance=0

            [filter]
                side=1
                id=$unit.id
            [/filter]
            ca_id=side1_capture_point_and_keep_it_NW
            ca_score=300100
            station_x=4
            station_y=10
        [/micro_ai]
    [/event]
    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=1
            x,y=30,10
        [/filter]

        [micro_ai]
            side=1
            action=add
            ai_type=stationed_guardian
            distance=0

            [filter]
                side=1
                id=$unit.id
            [/filter]
            ca_id=side1_capture_point_and_keep_it_NE
            ca_score=300100
            station_x=30
            station_y=10
        [/micro_ai]
    [/event]
    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=1
            x,y=17,17
        [/filter]

        [micro_ai]
            side=1
            action=add
            ai_type=stationed_guardian
            distance=0

            [filter]
                side=1
                id=$unit.id
            [/filter]
            ca_id=side1_capture_point_and_keep_it_Central
            ca_score=300100
            station_x=17
            station_y=17
        [/micro_ai]
    [/event]
    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=1
            x,y=30,23
        [/filter]

        [micro_ai]
            side=1
            action=add
            ai_type=stationed_guardian
            distance=0

            [filter]
                side=1
                id=$unit.id
            [/filter]
            ca_id=side1_capture_point_and_keep_it_SE
            ca_score=300100
            station_x=30
            station_y=23
        [/micro_ai]
    [/event]
    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=1
            x,y=4,23
        [/filter]

        [micro_ai]
            side=1
            action=add
            ai_type=stationed_guardian
            distance=0

            [filter]
                side=1
                id=$unit.id
            [/filter]
            ca_id=side1_capture_point_and_keep_it_SW
            ca_score=300100
            station_x=4
            station_y=23
        [/micro_ai]
    [/event]

    # side 2 MAI events
    # only applies if side 2 is computer controlled
    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=2
            x,y=4,23
        [/filter]

        [micro_ai]
            side=2
            action=add
            ai_type=stationed_guardian
            distance=0

            [filter]
                side=2
                id=$unit.id
            [/filter]
            ca_id=side2_capture_point_and_keep_it_SW
            ca_score=300100
            station_x=4
            station_y=23
        [/micro_ai]
    [/event]
    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=2
            x,y=30,23
        [/filter]

        [micro_ai]
            side=2
            action=add
            ai_type=stationed_guardian
            distance=0

            [filter]
                side=2
                id=$unit.id
            [/filter]
            ca_id=side2_capture_point_and_keep_it_SE
            ca_score=300100
            station_x=30
            station_y=23
        [/micro_ai]
    [/event]
    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=2
            x,y=17,17
        [/filter]

        [micro_ai]
            side=2
            action=add
            ai_type=stationed_guardian
            distance=0

            [filter]
                side=2
                id=$unit.id
            [/filter]
            ca_id=side2_capture_point_and_keep_it_Central
            ca_score=300100
            station_x=17
            station_y=17
        [/micro_ai]
    [/event]
    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=2
            x,y=30,10
        [/filter]

        [micro_ai]
            side=2
            action=add
            ai_type=stationed_guardian
            distance=0

            [filter]
                side=2
                id=$unit.id
            [/filter]
            ca_id=side2_capture_point_and_keep_it_NE
            ca_score=300100
            station_x=30
            station_y=10
        [/micro_ai]
    [/event]
    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=2
            x,y=4,10
        [/filter]

        [micro_ai]
            side=2
            action=add
            ai_type=stationed_guardian
            distance=0

            [filter]
                side=2
                id=$unit.id
            [/filter]
            ca_id=side2_capture_point_and_keep_it_NW
            ca_score=300100
            station_x=4
            station_y=10
        [/micro_ai]
    [/event]
[/multiplayer]

#undef SCORE_BOARD_UPDATE
#undef CHAT_UPDATE_MSG
#undef CAP_DECAP_EVENTS
